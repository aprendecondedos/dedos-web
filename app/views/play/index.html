{% extends '../layouts/play.html' %}

{% block content %}
<script>
$(function() {
    var socket = io.connect('');
    socket.on('news', function (data) {
        console.log('QUE');
        socket.emit('my other event', {my: 'data'});
    });
    $(document).on('click', '.token', function () {
        var element_id = $(this).attr('id');
        socket.emit('event:click:token', {id: element_id});
    });
    socket.on('connect', function () {
        socket.on('event:token', function (data) {
            console.log(data.id);
            $('#'+data.id).find('.badge').text('2').show();
        });
    });
});
</script>
<script>
$(window).on('resize', loadElements);

function loadElements(){
    var win = $(this),
        elements = $('.element'),
        orig = {
            width: {{project.resolution.x}},
            height: {{project.resolution.y}},
        },
        res = {
            width: $('.play-table').innerWidth(),
            height: $('.play-table').height()
        },
        coefficient = resolutionAdjust(orig, res);

    elements.hide();
    elements.each(function(){
        $(this).css({
            'left': ($(this).data('position').x)*coefficient.x,
            'top': ($(this).data('position').y)*coefficient.y,
            'width': ($(this).data('size').width)*coefficient.x,
            'height': ($(this).data('size').height)*coefficient.y
//            'transform': 'translate('+$(this).data('position-x')+'px, '+ $(this).data('position-y') + 'px)'
        });
        $(this).fadeIn('fast');
    });
}
function resolutionAdjust(orig, new_res) {
    return {
        x: (new_res.width*1)/orig.width,
        y: (new_res.height*1)/orig.height
    }
}
</script>
<style>
    .element{
        position: absolute;
    }
    .area{
        background-color: #f0f1f1;
        border: 2px dashed #8c8c8c;
    }
    .token{
        background-color: #fff;
        -webkit-border-radius: 6px;
        -moz-border-radius: 6px;
        border-radius: 6px;
        padding: 10px;
        border: 1px solid #8c8c8c;
    }
</style>
{{project.name}}
<div>
    {% for activity in project.activities %}
    <a class="margin-right-20 btn btn-sm btn-primary" href="/play/{{project.project}}/activity/{{activity.id}}">Actividad {{loop.index}}</a>
    {% endfor %}
</div>
<div style="position: relative;">
    {% for area in areas %}
    <div class="element area" data-position="{{ area.position|json_encode }}" data-size="{{ area.size|json_encode }}">
        {% for token in area.tokens %}
        <div class="element token" style="display: none;width: 200px;"
             id="{{token.id}}"
             data-position="{{ token.position|json_encode }}"
             data-size="{{ token.size|json_encode }}"
        >
            <span class="badge badge-success" style="display:none;position: absolute;right: 10px;bottom: 10px;"></span>
            {% if token.type == 'txt' %}
                {% include 'tokens/txt.html' %}
            {% elseif token.type == 'img' %}
                {% include 'tokens/img.html' %}
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endfor %}
</div>
{% endblock %}